@using Services.DTO;
@using Services.Services.ExtendedUserService;
@inject AuthenticationStateProvider AuthenticationStateProvider;
@inject IExtendedUserService ExtendedUserService;

<AuthorizeView>
    <Authorized>
        <a class="text-red dropdown-item" href="/ManageAccount">@UserName</a>
        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="/Cash">Кошелёк</a>
        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="#">Мои товары</a>
        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="#">Участвую в сборе пазлов</a>
        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="#">Обмен собранной картинки на товар</a>
        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="#">Правила участия</a>
        <div class="dropdown-divider"></div>

        <a class="dropdown-item" href="#">История операция</a>
        <div class="dropdown-divider"></div>

        <form method="post" action="/Account/LogOut">
            <button type="submit" class="nav-link btn btn-link">Выход</button>
        </form>
    </Authorized>
    <NotAuthorized>
        <a class="dropdown-item" href="/Account/Login">Войти</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/Account/Register">Зарегистрироваться</a>
    </NotAuthorized>
</AuthorizeView>



@code {
    string UserName = "";

    protected override void OnInitialized()
    {
        UserName = FindUserName().Result;
        base.OnInitialized();
    }

    private async Task<string> FindUserName()
    {
        string result = "";
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            ExtendedUserDto currentUser = ExtendedUserService.GetByEmail(user.Identity.Name);
            result = currentUser?.InnerName;
        }

        return result;
    }



}